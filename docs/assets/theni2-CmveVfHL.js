import"./pwa-DOeEgxuH.js";import{L as W,T as B,c as $,U as H}from"./config-CIWGv3Gd.js";import{A as y}from"./audio_manager-CdHsL4ip.js";import{t as V}from"./theni_words-xXaqkVpm.js";let l=0,h=!0,w="all",g=[],I=[],C=[],a=[],L=!1,b={};const S={},K={};async function Z(){Q(),Y(),P(),B.init($.timerDurations.theni2),window.location.hash?z():E(!1),document.getElementById("aiBtn")?.addEventListener("click",G)}function Q(){C=V.map((e,t)=>{const n=document.createElement("div");return n.className="slide",n.id=`slide - ${t} `,n.innerHTML=`
            <div class="category-badge">${e.category}</div>
            <div class="category-badge-ta">${e.category_ta}</div>
            <div class="difficulty-badge">${e.difficulty}</div>
            <div class="word-en">${e.word_en}</div>
            <div class="word-ta">${e.word_ta}</div>
        `,n}),a=[...C]}function j(e){return e?e.replace(/[^a-zA-Z0-9 \-_]/g,"").trim().replace(/\s+/g,"_").toLowerCase():""}function X(e){e.stopPropagation(),document.getElementById("categoryMenu")?.classList.toggle("show")}function Y(){const e=new Map;C.forEach(n=>{const o=n.querySelector(".category-badge")?.textContent,s=n.querySelector(".category-badge-ta")?.textContent,i=`${o} - ${s}`;e.has(i)||e.set(i,!0)}),I=Array.from(e.keys()),g=[...I];const t=document.getElementById("categoryList");t&&(t.innerHTML="",I.forEach(n=>{const o=document.createElement("div");o.className="dropdown-item";const s=document.createElement("input");s.type="checkbox",s.checked=!0,s.id=`cat-${n}`;const i=document.createElement("span");i.innerText=n,o.appendChild(s),o.appendChild(i),o.addEventListener("click",c=>{c.stopPropagation(),T(n)}),s.addEventListener("click",c=>{c.stopPropagation(),T(n)}),o.setAttribute("tabindex","0"),o.setAttribute("role","checkbox"),o.setAttribute("aria-checked","true"),o.addEventListener("keydown",c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),T(n))}),t.appendChild(o)})),q()}function T(e){const t=g.indexOf(e);t>-1?g.splice(t,1):g.push(e);const n=document.getElementById(`cat-${e}`);n&&(n.checked=g.includes(e)),q(),k()}function ee(e){const t=document.getElementById("selectAllCats");e.target!==t&&(t.checked=!t.checked);const n=t.checked;n?g=[...I]:g=[],document.querySelectorAll("#categoryList input").forEach(o=>{o.checked=n}),q(),k()}function q(){const e=document.getElementById("selectedCatText"),t=document.getElementById("selectAllCats");!e||!t||(g.length===I.length?(e.textContent="All Categories",t.checked=!0):g.length===0?(e.textContent="None selected",t.checked=!1):(e.textContent=`${g.length} selected`,t.checked=!1))}function k(e=!0){a=C.filter(t=>{const n=t.querySelector(".difficulty-badge")?.textContent,o=t.querySelector(".category-badge")?.textContent,s=t.querySelector(".category-badge-ta")?.textContent,i=`${o} - ${s}`,c=w==="all"||n===w,m=g.includes(i);return c&&m}),L&&H.shuffleArray(a),b={},e&&(l=0),P(),E()}function v(e){w=e,document.querySelectorAll(".pill-button").forEach(n=>{n.classList.remove("active"),n.setAttribute("aria-pressed","false")});const t=document.getElementById(`filter${e==="all"?"All":e}`);t&&(t.classList.add("active"),t.setAttribute("aria-pressed","true")),k()}function N(){L=!0;const e=document.getElementById("btn-shuffle");e&&(e.classList.add("active"),e.setAttribute("aria-pressed","true")),k()}function R(){L=!1;const e=document.getElementById("btn-shuffle");e&&(e.classList.remove("active"),e.setAttribute("aria-pressed","false")),k()}function P(){const e=a.filter(i=>i.querySelector(".difficulty-badge")?.textContent==="D1").length,t=a.filter(i=>i.querySelector(".difficulty-badge")?.textContent==="D2").length,n=w==="all"?"All Difficulty":w,o=L?" (Shuffled)":"",s=document.getElementById("progressInfo");s&&(s.textContent=`${a.length===0?0:l+1}/${a.length} slides - Filter: ${n}${o} (Matches: D1=${e}, D2=${t})`)}function te(e){localStorage.setItem("gemini_api_key",e);const t=document.getElementById("keyStatus");t&&(t.style.display="inline",setTimeout(()=>t.style.display="none",3e3))}function ne(){const e=localStorage.getItem("gemini_api_key");if(e){const t=document.getElementById("apiKeyInput");t&&(t.value=e)}}async function G(){const e=document.getElementById("aiBtn"),t=document.getElementById("aiResult"),n=document.getElementById("aiText"),o=document.getElementById("aiTextEn");B.pause();const s=document.getElementById("card1Ta")?.textContent,i=document.getElementById("card2Ta")?.textContent;if(!s||!i){alert("Cannot generate sentence without two words.");return}const c=localStorage.getItem("gemini_api_key");if(!c){alert("Please enter your Gemini API Key in the settings first.");const d=document.getElementById("controlPanel");d&&d.classList.contains("collapsed")&&d.classList.remove("collapsed");return}const m=c;if(!t||!n||!o)return;const x=`${s}|${i}`;if(S[x]){const d=S[x];r(d);return}e&&(e.disabled=!0,e.innerHTML="<span>‚è≥</span> Generating..."),t.style.display="none",t.classList.remove("show"),n.textContent="",o.textContent="";const p=`Generate a simple Tamil sentence using these two words: "${s}" and "${i}".
    Provide the response in JSON format: { "tamil": "tamil sentence", "english": "english meaning" }
    IMPORTANT: Use the exact Tamil words provided. Keep it simple.`;try{const u=await(await fetch(`${$.gemini.baseUrl}/${$.gemini.defaultModel}:generateContent?key=${m}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:p}]}]})})).json();if(u.error)throw new Error(u.error.message||"API Error");const f=u.candidates?.[0]?.content?.parts?.[0]?.text;if(f){const J=f.replace(/```json\n?|\n?```/g,"").trim(),M=JSON.parse(J);S[x]=M,r(M)}else throw new Error("No response text")}catch(d){const u=d instanceof Error?d.message:"Unknown error";console.error("AI Error:",d),alert("Error generating sentence: "+u),t&&(t.style.display="none")}finally{e&&(e.disabled=!1,e.innerHTML="<span>‚ú®</span> Generate Sentence")}function r(d){n.textContent=d.tamil,o.textContent=d.english,t.style.display="flex",setTimeout(()=>t.classList.add("show"),10),h&&y.speak(d.tamil,"ta-IN")}}function U(){if(h=document.getElementById("audioToggle").checked,h){const t=a[l],n=b[l],o=n!==void 0?a[n]:null;if(t){const s=t.querySelector(".word-en")?.textContent,i=o?.querySelector(".word-en")?.textContent;s&&(y.speak(s,"en-US"),i&&setTimeout(()=>{h&&y.speak(i,"en-US")},1500))}}else y.synth&&y.synth.speaking&&y.synth.cancel()}function E(e=!0){const t=document.getElementById("aiResult"),n=document.getElementById("aiText"),o=document.getElementById("aiTextEn"),s=document.getElementById("aiBtn");if(t&&(t.style.display="none",t.classList.remove("show")),n&&(n.textContent=""),o&&(o.textContent=""),s&&(s.disabled=!1,s.innerHTML="<span>‚ú®</span> Generate Sentence with AI"),document.getElementById("card1")?.classList.remove("revealed"),document.getElementById("card2")?.classList.remove("revealed"),a.length<2){document.getElementById("card1En")&&(document.getElementById("card1En").textContent="Not enough words"),A(2,document.createElement("div"));return}const i=a[l];let c;if(b[l]!==void 0)c=b[l];else{do c=Math.floor(Math.random()*a.length);while(c===l);b[l]=c}const m=a[c],p=m.querySelector(".slide-image")?.dataset.word||m.querySelector(".word-en")?.textContent?.toLowerCase();if(p){const u=new Image;u.src=`assets/images/theni12/${j(p)}.jpg`}if(A(1,i),A(2,m),h&&e){const u=i.querySelector(".word-en")?.textContent,f=m.querySelector(".word-en")?.textContent;u&&(y.speak(u,"en-US"),f&&y.speak(f,"en-US"))}document.getElementById("firstBtn").disabled=l===0,document.getElementById("prevBtn").disabled=l===0,document.getElementById("nextBtn").disabled=l===a.length-1,document.getElementById("lastBtn").disabled=l===a.length-1;const r=document.getElementById("counter");r&&(r.innerText=`${l+1} / ${a.length}`),H.updateProgress(l,a.length,"progressBar","counter"),P();const d=document.getElementById("showTimer");d&&d.checked&&B.restart()}function A(e,t){try{const n="card"+e,o=t.querySelector(".word-en")?.textContent||"",s=t.querySelector(".word-ta")?.textContent||"",i=t.querySelector(".category-badge")?.textContent||"",c=t.querySelector(".category-badge-ta")?.textContent||"",m=t.querySelector(".difficulty-badge")?.textContent||"",p=t.querySelector(".slide-image")?.dataset.word||o.toLowerCase();document.getElementById(n+"En")&&(document.getElementById(n+"En").textContent=o),document.getElementById(n+"Ta")&&(document.getElementById(n+"Ta").textContent=s),document.getElementById(n+"Cat")&&(document.getElementById(n+"Cat").textContent=i),document.getElementById(n+"CatTa")&&(document.getElementById(n+"CatTa").textContent=c),document.getElementById(n+"Diff")&&(document.getElementById(n+"Diff").textContent=m);const r=document.getElementById(n+"Img");if(r){const d=j(p);if(K[p])r.src=K[p];else{const u=`assets/images/theni12/${d}.jpg`,f="/tamiltheni/"+u;r.src=f,r.onerror=function(){if(r.onerror=null,r.src.includes(f)){console.warn(`[ImageLoad] Failed absolute path: ${f}. Retrying with relative...`),r.src=`../${u}`;return}r.src=`https://placehold.co/300x180?text=${encodeURIComponent(o)}`}}r.alt=o}}catch(n){console.error("Error in updateCard "+e+":",n)}}function _(){a.length>0&&(l=0,E())}function F(){a.length>0&&(l=a.length-1,E())}function D(e){const t=l+e;t>=0&&t<a.length&&(l=t,E())}function O(){if(!a[l])return;const e=document.getElementById("card1"),t=document.getElementById("card2");if(!e||!t)return;e.classList.contains("revealed")&&t.classList.contains("revealed")?D(1):(e.classList.add("revealed"),t.classList.add("revealed"))}function z(){const e=window.location.hash.substring(1),t=`slide-${parseInt(e)-1}`,n=a.findIndex(o=>o.id===t);n!==-1?(l=n,E()):a.length>0&&(l>=a.length&&(l=0),E())}function oe(){W.init({title:"‡Æ™‡Æø‡ÆØ‡Øã‡Æ∞‡Æø‡ÆØ‡Ææ ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç‡Æ™‡Øç ‡Æ™‡Æ≥‡Øç‡Æ≥‡Æø - ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç‡Æ§‡Øç ‡Æ§‡Øá‡Æ©‡Æø 2026 - Theni 2",contentHTML:`
            <div class="control-row">
                <span class="control-label">Categories:</span>
                <div class="category-dropdown">
                    <button class="dropdown-button" id="cat-dropdown-btn">
                        <span id="selectedCatText">All Categories</span>
                        <span>‚ñº</span>
                    </button>
                    <div class="dropdown-menu" id="categoryMenu">
                        <div class="dropdown-item header" id="select-all-cat-row">
                            <input type="checkbox" id="selectAllCats" checked>
                            <span>Select All / None</span>
                        </div>
                        <div id="categoryList"></div>
                    </div>
                </div>
            </div>
            <div class="control-row">
                <span class="control-label">Difficulty:</span>
                <div class="pill-group">
                    <button class="pill-button active" id="filterAll" aria-pressed="true">All</button>
                    <button class="pill-button" id="filterD1" aria-pressed="false">D1 Only</button>
                    <button class="pill-button" id="filterD2" aria-pressed="false">D2 Only</button>
                </div>
            </div>
            <div class="control-row">
                <span class="control-label">Sequence:</span>
                <div class="pill-group">
                    <button class="action-button" id="btn-shuffle" aria-pressed="false"><span aria-hidden="true">üîÄ</span> Shuffle</button>
                    <button class="action-button" id="btn-reset-seq"><span aria-hidden="true">‚Ü©Ô∏è</span> Reset</button>
                </div>
                <div style="margin-left: auto; display: flex; gap: 15px;">
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 0.85em;">
                        <input type="checkbox" id="showTimer" checked> ‚è±Ô∏è Timer (20s)
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 0.85em;">
                        <input type="checkbox" id="audioToggle"> üîä Audio
                    </label>
                </div>
            </div>
            <div class="control-row">
                <span class="control-label">Progress:</span>
                <span class="progress-info" id="progressInfo">Loading...</span>
                <div style="margin-left: auto; display: flex; gap: 10px; align-items: center;">
                    <label style="font-size: 0.85em; display: flex; align-items: center; gap: 6px;">üîë Gemini AI API:</label>
                    <input type="password" id="apiKeyInput" placeholder="Enter API Key" 
                           style="padding: 4px 8px; border-radius: 6px; border: 1px solid rgba(255,255,255,0.5); background: rgba(255,255,255,0.15); color: white; font-size: 0.85em; width: 140px;">
                    <style>#apiKeyInput::placeholder { color: rgba(255,255,255,0.7); font-style: italic; }</style>
                </div>
            </div>
        `,timerDisplay:"00:20",injectNavigation:!0}),document.getElementById("cat-dropdown-btn")?.addEventListener("click",X),document.getElementById("select-all-cat-row")?.addEventListener("click",ee),document.getElementById("filterAll")?.addEventListener("click",()=>v("all")),document.getElementById("filterD1")?.addEventListener("click",()=>v("D1")),document.getElementById("filterD2")?.addEventListener("click",()=>v("D2")),document.getElementById("btn-shuffle")?.addEventListener("click",N),document.getElementById("btn-reset-seq")?.addEventListener("click",R),document.getElementById("showTimer")?.addEventListener("change",B.toggleVisibility.bind(B)),document.getElementById("audioToggle")?.addEventListener("change",U),document.addEventListener("panelCollapsed",()=>{document.getElementById("audioToggle")?.checked&&!h&&(h=!0,U())}),document.getElementById("firstBtn")?.addEventListener("click",e=>{e.stopPropagation(),_()}),document.getElementById("prevBtn")?.addEventListener("click",e=>{e.stopPropagation(),D(-1)}),document.getElementById("nextBtn")?.addEventListener("click",e=>{e.stopPropagation(),O()}),document.getElementById("lastBtn")?.addEventListener("click",e=>{e.stopPropagation(),F()}),document.getElementById("apiKeyInput")?.addEventListener("change",e=>te(e.target.value)),document.getElementById("aiBtn")?.addEventListener("click",G),document.addEventListener("click",e=>{if(e.target.closest(".category-dropdown")||document.getElementById("categoryMenu")?.classList.remove("show"),!e.target.closest(".control-panel")){const t=document.getElementById("controlPanel");t&&!t.classList.contains("collapsed")&&t.classList.add("collapsed")}}),document.addEventListener("keydown",e=>{e.key==="ArrowLeft"&&D(-1),(e.key==="ArrowRight"||e.key===" "||e.key==="Enter")&&O(),e.key==="Home"&&_(),e.key==="End"&&F(),e.key==="1"&&v("D1"),e.key==="2"&&v("D2"),(e.key==="a"||e.key==="A")&&v("all"),(e.key==="s"||e.key==="S")&&N(),(e.key==="r"||e.key==="R")&&R()}),window.addEventListener("hashchange",z),ne(),Z()}document.addEventListener("DOMContentLoaded",oe);
