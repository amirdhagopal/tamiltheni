import"./pwa-DOeEgxuH.js";import{L as z,T as w,c as _,U as F}from"./config-TkLmu2ao.js";import{A as m}from"./audio_manager-CdHsL4ip.js";import{t as H}from"./theni_words-xXaqkVpm.js";let s=0,g=!0,C=!1,y=null,b="all",r=[],h=[],v=[],l=[],L=!1;const T=window.SpeechRecognition||window.webkitSpeechRecognition;let a=null,E=!1;T?(a=new T,a.lang="ta-IN",a.interimResults=!1,a.maxAlternatives=1,a.onresult=e=>{const t=e.results[0][0].transcript.trim();J(t)},a.onerror=e=>{e.error!=="no-speech"&&(console.error("Speech recognition error:",e.error),x("Error: "+e.error,"error")),p()},a.onend=()=>{E&&p()}):console.warn("Speech recognition not supported.");function U(){const e=document.getElementById("slides-wrapper");if(!e){console.error("Missing slides-wrapper");return}e.innerHTML="",H.forEach((t,i)=>{const n=document.createElement("div");n.className=i===0?"slide active":"slide",n.id=`slide-${i}`,n.style.display=i===0?"flex":"none",n.innerHTML=`
            <div class="image-container">
                <img src="https://placehold.co/400x300?text=Loading..."
                     data-word="${t.image_word}"
                     alt="${t.word_en}"
                     class="slide-image">
            </div>
            <div class="word-row">
                <div class="word-en">${t.word_en}</div>
                <button class="mic-button-inline" id="mic-btn-${i}" title="Voice Validation" aria-label="Start Voice Validation">ЁЯОд</button>
                <span class="voice-feedback-inline" role="status" aria-live="polite"></span>
            </div>
            <div class="word-ta">${t.word_ta}</div>
            <div class="card-footer">
                <div class="footer-left">
                    <span class="category-badge">${t.category}</span>
                    <span class="category-badge-ta">${t.category_ta}</span>
                    <span class="difficulty-badge">${t.difficulty}</span>
                </div>
            </div>
        `,e.appendChild(n);const o=n.querySelector(`#mic-btn-${i}`);o&&o.addEventListener("click",c=>{c.stopPropagation(),Z()})}),v=Array.from(document.querySelectorAll(".slide")),l=[...v]}function O(e){e.stopPropagation(),document.getElementById("categoryMenu")?.classList.toggle("show")}function j(){const e=new Map;v.forEach(i=>{const n=i.querySelector(".category-badge")?.textContent,o=i.querySelector(".category-badge-ta")?.textContent,c=`${n} - ${o}`;e.has(c)||e.set(c,!0)}),h=Array.from(e.keys()),r=[...h];const t=document.getElementById("categoryList");t&&(t.innerHTML="",h.forEach(i=>{const n=document.createElement("div");n.className="dropdown-item";const o=document.createElement("input");o.type="checkbox",o.checked=!0,o.id=`cat-${i}`;const c=document.createElement("span");c.innerText=i,n.appendChild(o),n.appendChild(c),n.addEventListener("click",d=>{d.stopPropagation(),S(i)}),o.addEventListener("click",d=>{d.stopPropagation(),S(i)}),n.setAttribute("tabindex","0"),n.setAttribute("role","checkbox"),n.setAttribute("aria-checked","true"),n.addEventListener("keydown",d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),S(i))}),t.appendChild(n)}),A())}function S(e){const t=r.indexOf(e);t>-1?r.splice(t,1):r.push(e);const i=document.getElementById(`cat-${e}`);i&&(i.checked=r.includes(e)),document.querySelectorAll("#categoryList .dropdown-item").forEach(o=>{o.textContent===e&&o.setAttribute("aria-checked",r.includes(e).toString())}),A(),k()}function K(e){const t=document.getElementById("selectAllCats");e.target!==t&&(t.checked=!t.checked);const i=t.checked;i?r=[...h]:r=[],document.querySelectorAll("#categoryList input").forEach(n=>{n.checked=i}),A(),k()}function A(){const e=document.getElementById("selectedCatText"),t=document.getElementById("selectAllCats");!e||!t||(r.length===h.length?(e.textContent="All Categories",t.checked=!0):r.length===0?(e.textContent="None selected",t.checked=!1):(e.textContent=`${r.length} selected`,t.checked=!1))}function k(e=!0){l=v.filter(t=>{const i=t.querySelector(".difficulty-badge")?.textContent,n=t.querySelector(".category-badge")?.textContent,o=t.querySelector(".category-badge-ta")?.textContent,c=`${n} - ${o}`,d=b==="all"||i===b,N=r.includes(c);return d&&N}),L&&F.shuffleArray(l),e&&(s=0),$(),u()}function f(e){b=e,document.querySelectorAll(".pill-button").forEach(i=>{i.classList.remove("active"),i.setAttribute("aria-pressed","false")});const t=document.getElementById(`filter${e==="all"?"All":e}`);t&&(t.classList.add("active"),t.setAttribute("aria-pressed","true")),k()}function D(){L=!0;const e=document.getElementById("btn-shuffle");e&&(e.classList.add("active"),e.setAttribute("aria-pressed","true")),k()}function q(){L=!1;const e=document.getElementById("btn-shuffle");e&&(e.classList.remove("active"),e.setAttribute("aria-pressed","false")),k()}function $(){const e=l.filter(c=>c.querySelector(".difficulty-badge")?.textContent==="D1").length,t=l.filter(c=>c.querySelector(".difficulty-badge")?.textContent==="D2").length,i=b==="all"?"All Difficulty":b,n=L?" (Shuffled)":"",o=document.getElementById("progressInfo");o&&(o.textContent=`${l.length===0?0:s+1}/${l.length} slides - Filter: ${i}${n} (Matches: D1=${e}, D2=${t})`)}function W(e,t){if(!e)return;const n=`assets/images/theni12/${e.replace(/[^a-zA-Z0-9 \-_]/g,"").trim().replace(/\s+/g,"_")}.jpg`,o="/tamiltheni/"+n.replace(/^assets\//,"assets/");t.onerror=function(){if(t.onerror=null,t.src.includes(o)){console.warn(`[ImageLoad] Failed absolute path: ${o}. Retrying with relative...`),t.src=`../${n}`;return}console.warn(`Missing local image for: ${e} (${o})`),t.src=`https://placehold.co/400x300?text=${encodeURIComponent(e)}`},t.src=o}function Z(){if(!a){alert("Speech recognition is not supported in this browser.");return}E?p():G()}function G(){if(a)try{a.start(),E=!0;const t=l[s]?.querySelector(".mic-button-inline");t&&(t.classList.add("recording"),t.setAttribute("title","Voice Validation is ACTIVE - Click to Stop Listening")),x("Listening for Tamil...","success")}catch(e){console.error("Recognition start error:",e)}}function p(){a&&E&&a.stop(),E=!1,document.querySelectorAll(".mic-button-inline.recording").forEach(e=>{e.classList.remove("recording"),e.setAttribute("title","Voice Validation - Click to Start Listening")})}function J(e){const t=l[s];if(!t)return;const i=t.querySelector(".word-ta")?.textContent?.trim()||"",n=d=>d.toLowerCase().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"").replace(/\s+/g,""),o=n(e),c=n(i);o===c||c.includes(o)||o.includes(c)?(x(`Correct! тЬЕ (${e})`,"success"),t.classList.add("revealed")):x(`Heard "${e}" тЭМ`,"error"),p()}function x(e,t){const n=l[s]?.querySelector(".voice-feedback-inline");n&&(n.textContent=e,n.className=`voice-feedback-inline ${t}`,t!=="recording"&&!e.includes("Listening")&&setTimeout(()=>{n.textContent===e&&(n.className="voice-feedback-inline",n.textContent="")},4e3))}function R(){if(g=document.getElementById("audioToggle").checked,g){const t=l[s];if(t){const i=t.querySelector(".word-en");i&&i.textContent&&m.speak(i.textContent,"en-US")}}else y&&clearTimeout(y),m.synth&&m.synth.speaking&&m.synth.cancel()}function Q(){C=document.getElementById("voiceToggle").checked,document.querySelectorAll(".mic-button-inline").forEach(t=>{t.style.display=C?"flex":"none"}),C||(document.querySelectorAll(".voice-feedback-inline").forEach(t=>{t.textContent="",t.className="voice-feedback-inline"}),p())}function u(e=!0){v.forEach(t=>{t.classList.remove("active"),t.style.display="none",t.style.visibility="hidden"}),l.forEach((t,i)=>{if(t.style.display=i===s?"flex":"none",t.style.visibility=i===s?"visible":"hidden",i===s){t.classList.add("active");const n=t.querySelector(".slide-image");n&&n.dataset.word&&!n.dataset.loaded&&(W(n.dataset.word,n),n.dataset.loaded="true");const o=t.querySelector(".word-en");o&&o.textContent&&(y&&clearTimeout(y),g&&e&&(y=setTimeout(()=>{g&&o.textContent&&m.speak(o.textContent,"en-US")},300))),p()}else t.classList.remove("revealed")}),document.getElementById("firstBtn").disabled=s===0,document.getElementById("prevBtn").disabled=s===0,document.getElementById("nextBtn").disabled=s===l.length-1,document.getElementById("lastBtn").disabled=s===l.length-1,F.updateProgress(s,l.length,"progressBar","counter"),$(),document.getElementById("showTimer").checked&&w.restart()}function M(){l.length>0&&(s=0,u())}function P(){l.length>0&&(s=l.length-1,u())}function I(e){const t=s+e;t>=0&&t<l.length&&(s=t,u())}function B(){l[s]&&(l[s].classList.contains("revealed")?I(1):l[s].classList.add("revealed"))}function V(){const e=window.location.hash.substring(1),t=`slide-${parseInt(e)-1}`,i=l.findIndex(n=>n.id===t);i!==-1?(s=i,u()):l.length>0&&(s>=l.length&&(s=0),u())}function X(){z.init({title:"рокро┐ропрпЛро░ро┐ропро╛ родрооро┐ро┤рпНрокрпН рокро│рпНро│ро┐ - родрооро┐ро┤рпНродрпН родрпЗройро┐ 2026 - Theni 1",contentHTML:`
            <div class="control-row">
                <span class="control-label">Categories:</span>
                <div class="category-dropdown">
                    <button class="dropdown-button" id="cat-dropdown-btn" title="Select word categories to display">
                        <span id="selectedCatText">All Categories</span>
                        <span>тЦ╝</span>
                    </button>
                    <div class="dropdown-menu" id="categoryMenu">
                        <div class="dropdown-item header" id="select-all-cat-row">
                            <input type="checkbox" id="selectAllCats" checked>
                            <span>Select All / None</span>
                        </div>
                        <div id="categoryList"></div>
                    </div>
                </div>
            </div>
            <div class="control-row">
                <span class="control-label">Difficulty:</span>
                <div class="pill-group">
                <div class="pill-group">
                    <button class="pill-button active" id="filterAll" title="Show all difficulty levels (A)" aria-pressed="true">All</button>
                    <button class="pill-button" id="filterD1" title="Show only Difficulty 1 words (1)" aria-pressed="false">D1 Only</button>
                    <button class="pill-button" id="filterD2" title="Show only Difficulty 2 words (2)" aria-pressed="false">D2 Only</button>
                </div>
                </div>
            </div>
            <div class="control-row">
                <span class="control-label">Sequence:</span>
                <div class="pill-group">
                    <button class="action-button" id="btn-shuffle" title="Randomize slide order (S)" aria-pressed="false"><span aria-hidden="true">ЁЯФА</span> Shuffle</button>
                    <button class="action-button" id="btn-reset-seq" title="Reset to original order (R)"><span aria-hidden="true">тЖйя╕П</span> Reset</button>
                </div>
                <div style="margin-left: auto; display: flex; gap: 15px;">
                    <label title="Show/hide countdown timer" style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 0.85em;">
                        <input type="checkbox" id="showTimer" checked> тП▒я╕П Timer (8s)
                    </label>
                    <label title="Enable/disable word pronunciation" style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 0.85em;">
                        <input type="checkbox" id="audioToggle" checked> ЁЯФК Audio
                    </label>
                    <label title="Enable/disable voice recognition" style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 0.85em;">
                        <input type="checkbox" id="voiceToggle"> ЁЯОд Voice
                    </label>
                </div>
            </div>
            <div class="control-row">
                <span class="control-label">Progress:</span>
                <span class="progress-info" id="progressInfo">Loading...</span>
            </div>
        `,timerDisplay:"00:08",injectNavigation:!0}),document.getElementById("cat-dropdown-btn")?.addEventListener("click",O),document.getElementById("select-all-cat-row")?.addEventListener("click",K),document.getElementById("filterAll")?.addEventListener("click",()=>f("all")),document.getElementById("filterD1")?.addEventListener("click",()=>f("D1")),document.getElementById("filterD2")?.addEventListener("click",()=>f("D2")),document.getElementById("btn-shuffle")?.addEventListener("click",D),document.getElementById("btn-reset-seq")?.addEventListener("click",q),document.getElementById("showTimer")?.addEventListener("change",w.toggleVisibility.bind(w)),document.getElementById("audioToggle")?.addEventListener("change",R),document.getElementById("voiceToggle")?.addEventListener("change",Q),document.addEventListener("panelCollapsed",()=>{document.getElementById("audioToggle")?.checked&&!g&&(g=!0,R())}),document.getElementById("firstBtn")?.addEventListener("click",e=>{e.stopPropagation(),M()}),document.getElementById("prevBtn")?.addEventListener("click",e=>{e.stopPropagation(),I(-1)}),document.getElementById("nextBtn")?.addEventListener("click",e=>{e.stopPropagation(),B()}),document.getElementById("lastBtn")?.addEventListener("click",e=>{e.stopPropagation(),P()}),document.getElementById("slides-wrapper")?.addEventListener("click",e=>{e.target.closest("button, input, .control-panel")||B()}),document.addEventListener("click",e=>{if(e.target.closest(".category-dropdown")||document.getElementById("categoryMenu")?.classList.remove("show"),!e.target.closest(".control-panel")){const t=document.getElementById("controlPanel");t&&!t.classList.contains("collapsed")&&t.classList.add("collapsed")}}),document.addEventListener("keydown",e=>{e.key==="ArrowLeft"&&I(-1),(e.key==="ArrowRight"||e.key===" "||e.key==="Enter")&&B(),(e.key==="Home"||e.key==="[")&&M(),(e.key==="End"||e.key==="]")&&P(),e.key==="1"&&f("D1"),e.key==="2"&&f("D2"),(e.key==="a"||e.key==="A")&&f("all"),(e.key==="s"||e.key==="S")&&D(),(e.key==="r"||e.key==="R")&&q()}),window.addEventListener("hashchange",V),U(),j(),w.init(_.timerDurations.theni1),$(),window.location.hash?V():u(!1)}document.addEventListener("DOMContentLoaded",X);
